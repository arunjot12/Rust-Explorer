<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Blockchain Dashboard</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <h1>Stored Blockchains</h1>
        <p class="subtitle">A list of all blockchain entries from the database</p>
        <div id="id" class="card-container">
            <!-- Blockchain entries will be injected here -->
        </div>
        <p class="subtitle">Delete the blockchain from the Database</p>
        <input type="text" id="blockchain_id" placeholder= "Blockchain Id" />
        <button type ="submit"  class="btn btn-primary" onclick="Deleteblockchains()">Submit</button>
    </div>

    <script>
        async function fetchBlockchains() {
            try {
                const response = await fetch("http://127.0.0.1:8000/get_all_blockchains");

                const data = await response.json();

                const listContainer = document.getElementById("id");
                if (data.length === 0) {
                    listContainer.innerHTML = "<p class='empty'>No blockchains found ðŸ˜¢</p>";
                    return;
                }

                data.forEach((bc) => {
                    const card = document.createElement("div");
                    const validatorsArray = JSON.parse(bc.validators);
                    const formattedValidators = `
                        <ol>
                            ${validatorsArray.map((v) => `<li><code>${v}</code></li>`).join('')}
                        </ol>
                    `;
                    card.className = "card";
                    card.innerHTML = `
                        <h2>${bc.blockchain_name}</h2>
                        <p><strong>ID:</strong> ${bc.id}</p>
                        <p><strong>Validators Count:</strong> ${bc.validator_count}</p>
                        <div><strong>Validators:</strong> ${formattedValidators}</div>
                    `;
                    listContainer.appendChild(card);
                });
            } catch (error) {
                document.getElementById("id").innerHTML = 
                    `<p class="error">Failed to fetch blockchains: ${error}</p>`;
            }
        }   

        async function Deleteblockchains() {
        const blockchainId = document.getElementById("blockchain_id").value.trim();

        if (!blockchainId) {
            alert("Please enter a Blockchain ID to delete.");
            return;
        }

        try {
            const response = await fetch("http://127.0.0.1:8000/delete_blockchains", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({ id: parseInt(blockchainId) })
            });

            if (!response.ok) {
                throw new Error(`Server responded with status ${response.status}`);
            }

            alert("Blockchain deleted successfully!");
            document.getElementById("id").innerHTML = "";
            document.getElementById("blockchain_id").value = "";
            fetchBlockchains(); // Refresh the list
        } catch (err) {
            alert("Deletion failed.");
            console.error(err);
        }
    }
        fetchBlockchains();
    </script>
</body>
</html>
